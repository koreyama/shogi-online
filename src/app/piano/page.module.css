.container {
    width: 100vw;
    height: 100vh;
    background: #f8f9fa;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #333;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    user-select: none;
    overflow: hidden;
    position: relative;
}

/* Loading Overlay */
.loadingOverlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #333;
}

.loadingBarContainer {
    width: 300px;
    height: 4px;
    background: #eee;
    border-radius: 2px;
}

.loadingBarFill {
    height: 100%;
    background: #333;
    transition: width 0.1s;
}

/* Header */
.header {
    margin-bottom: 2.5rem;
    text-align: center;
    flex-shrink: 0;
}

.title {
    margin: 0;
    font-weight: 300;
    letter-spacing: 2px;
    color: #111;
    font-size: 2rem;
}

.subtitle {
    color: #888;
    font-size: 0.8rem;
    margin-top: 1rem;
    padding: 1.5rem;
    background: #fff;
    border-radius: 12px;
    width: 100%;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.songSelectorRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.selectorGroup {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.playBtn {
    background: #4f46e5;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: all 0.2s;
}

.playBtn:hover {
    background: #4338ca;
    transform: translateY(-1px);
}

.playBtn.playing {
    background: #ef4444;
}

.playBtn.playing:hover {
    background: #dc2626;
}

.toggleGroup {
    display: flex;
    background: #e2e8f0;
    border-radius: 6px;
    padding: 2px;
}

.toggleBtn {
    border: none;
    background: transparent;
    padding: 4px 12px;
    font-size: 0.9rem;
    border-radius: 4px;
    cursor: pointer;
    color: #64748b;
    font-weight: 500;
}

.toggleBtn.active {
    background: #fff;
    color: #0f172a;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.sheetMusicDisplay {
    background: #fff;
    padding: 1rem 1rem 3rem 4rem;
    /* Left padding for Clef */
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    overflow-x: auto;
    position: relative;
    min-height: 200px;
}



.scoreContainer {
    display: flex;
    flex-wrap: wrap;
    gap: 0;
    justify-content: flex-start;
    /* Left align flow */
    row-gap: 4rem;
}

.measure {
    display: flex;
    position: relative;
    padding: 0 1.5rem;
    align-items: flex-end;
    /* Align notes to bottom for relative positioning */
    /* Staff lines removed */
    background: transparent;
    border-bottom: 1px solid #e2e8f0;
    /* Keeping a baseline */
    align-items: flex-end;
}

/* Removed barLine sizing dependency on staff height? Actually let's keep it simple. */
.barLine {
    width: 2px;
    height: 100%;
    background-color: #cbd5e1;
    margin-left: 1rem;
    position: absolute;
    top: 0;
    right: 0;
}

.scoreNote {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    margin: 0 0.5rem;
    position: relative;
    height: 40px;
    /* Base height anchor */
    width: 30px;
    /* Inline style will transform translateY or marginBottom */
}

/* Note Visuals */
.noteVisual {
    position: relative;
    width: 100%;
    height: 100%;
    /* Override flex for absolute positioning of parts */
}

.noteHead {
    position: absolute;
    bottom: -5px;
    /* Center on the '0' line */
    left: 50%;
    transform: translateX(-50%) rotate(-15deg);
    width: 14px;
    height: 10px;
    background: #1e293b;
    border-radius: 50%;
    z-index: 2;
    transition: all 0.1s;
}

.noteStem {
    position: absolute;
    right: 8px;
    /* Adjust based on head width */
    bottom: -5px;
    /* Start from head center */
    width: 1px;
    height: 35px;
    /* Stem length */
    background: #1e293b;
    z-index: 1;
}

.stemDown {
    right: auto;
    left: 8px;
    bottom: auto;
    top: 5px;
    /* Start from head center down */
    transform: translateY(100%);
    /* Wait, top is relative. */
    /* Actually simpler: */
    top: 5px;
    bottom: auto;
}

/* Fix stem down logic:
   If stem down, it attaches to left side of head and goes down.
   Base position is center of head.
   If Stem Up: Bottom=Center, goes up.
   If Stem Down: Top=Center, goes down.
*/
.scoreNote .noteStem.stemDown {
    right: auto;
    left: 7px;
    bottom: auto;
    top: 0px;
    /* From center of head roughly */
    /* We need to push it down */
    transform-origin: top;
    height: 35px;
}

/* Ledger Line */


/* Half/Whole Styles */
.scoreNote.half .noteHead,
.scoreNote.whole .noteHead {
    background: transparent;
    border: 2px solid #1e293b;
    box-sizing: border-box;
}

.scoreNote.whole .noteStem {
    display: none;
}

.noteLabel {
    position: absolute;
    bottom: -35px;
    /* Below the staff */
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8rem;
    font-weight: 600;
    color: #64748b;
    white-space: nowrap;
}

/* Active State */
.activeNote .noteHead {
    background: #f59e0b;
    /* Orange */
    transform: translateX(-50%) rotate(-15deg) scale(1.2);
}

.activeNote.half .noteHead,
.activeNote.whole .noteHead {
    border-color: #f59e0b;
    background: transparent;
}

.activeNote .noteLabel {
    color: #f59e0b;
    font-weight: 800;
}

/* Control Panel */
.controlPanel {
    display: flex;
    gap: 2.5rem;
    margin-bottom: 2rem;
    background: #fff;
    padding: 1.2rem 2.5rem;
    border-radius: 50px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    align-items: center;
    flex-shrink: 0;
    z-index: 100;
}

.homeButton {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #f0f0f0;
    color: #555;
    transition: all 0.2s;
    border: none;
    cursor: pointer;
    text-decoration: none;
}

.homeButton svg {
    width: 18px;
    height: 18px;
}

.homeButton:hover {
    background: #e0e0e0;
    color: #333;
}

.controlGroup {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.controlGroup+.controlGroup {
    border-left: 1px solid #eee;
    padding-left: 2.5rem;
}

.label {
    font-size: 0.7rem;
    color: #999;
    margin-bottom: 0.5rem;
    font-weight: 600;
    white-space: nowrap;
}

.slider {
    width: 80px;
    cursor: pointer;
    accent-color: #333;
}

.select {
    background: transparent;
    color: #333;
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 0.85rem;
    outline: none;
    cursor: pointer;
    min-width: 160px;
}

.metronomeButton {
    border: none;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
}

/* Piano Chassis */
.pianoChassis {
    position: relative;
    background: #fff;
    padding: 30px 20px 20px 20px;
    border-radius: 12px;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
    border: 1px solid #f0f0f0;
    max-width: 100vw;
}

.keysContainer {
    display: flex;
    position: relative;
    z-index: 1;
}

/* Keys */
.whiteKey {
    width: 60px;
    height: 280px;
    border: 1px solid #e0e0e0;
    border-radius: 0 0 4px 4px;
    margin-right: -1px;
    cursor: pointer;
    position: relative;
    z-index: 1;
    transform-origin: top;
    transition: transform 0.05s ease-out, background 0.1s;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 20px;
    font-weight: 500;
    font-size: 0.7rem;
    flex-shrink: 0;
    /* Prevent compression */
}

.blackKey {
    position: absolute;
    top: 0;
    width: 40px;
    height: 170px;
    border-radius: 0 0 3px 3px;
    cursor: pointer;
    z-index: 10;
    transform-origin: top;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 15px;
    font-size: 0.6rem;
    transition: transform 0.05s ease-out;
}

/* Footer & MIDI */
.footer {
    padding-top: 1rem;
    display: flex;
    gap: 20px;
    flex-shrink: 0;
}

.midiStatus {
    position: fixed;
    bottom: 20px;
    right: 20px;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 255, 255, 0.8);
    padding: 4px 8px;
    border-radius: 4px;
    backdrop-filter: blur(4px);
}

/* Portrait Overlay */
.portraitOverlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: #1a202c;
    color: white;
    z-index: 9999;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 2rem;
}

.rotateIcon {
    width: 64px;
    height: 64px;
    margin-bottom: 1.5rem;
    animation: rotateAnimation 2s infinite;
}

@keyframes rotateAnimation {
    0% {
        transform: rotate(0deg);
    }

    30% {
        transform: rotate(-90deg);
    }

    100% {
        transform: rotate(-90deg);
    }
}

/* Mobile Portrait Enforcement */
@media (max-width: 900px) and (orientation: portrait) {
    .portraitOverlay {
        display: flex;
    }

    /* Hide main content when asking to rotate */
    .header,
    .controlPanel,
    .pianoChassis,
    .footer,
    .midiStatus {
        display: none !important;
    }
}

/* Mobile Landscape Optimization */
@media (max-height: 500px) and (orientation: landscape) {
    .container {
        padding: 0;
        justify-content: flex-start;
        overflow: hidden;
    }

    .header {
        display: none;
    }

    .footer {
        display: none;
    }

    /* Highly Compact Control Panel */
    .controlPanel {
        padding: 0.2rem 1rem;
        margin: 0;
        margin-bottom: 2px;
        gap: 0.5rem;
        transform: scale(0.9);
        transform-origin: top center;
        width: 100%;
        border-radius: 0 0 16px 16px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(5px);
        z-index: 20;
        justify-content: center;
        flex-wrap: nowrap;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        min-height: 40px;
        /* Force minimum height to contain items */
        flex-shrink: 0;
        /* Don't shrink below content size */
    }

    .homeButton {
        width: 24px;
        height: 24px;
        background: #eee;
        margin-right: 0.5rem;
    }

    .homeButton svg {
        width: 14px;
        height: 14px;
    }

    .controlGroup {
        min-width: auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0;
    }

    .controlGroup+.controlGroup {
        padding-left: 0.8rem;
        border-left: 1px solid #eee;
    }

    .label {
        display: block;
        font-size: 0.6rem;
        line-height: 1;
        margin-bottom: 2px;
        color: #666;
        white-space: nowrap;
    }

    .slider {
        width: 60px;
        height: 4px;
        margin: 0;
        padding: 0;
    }

    .select {
        padding: 0 4px;
        height: 18px;
        font-size: 0.7rem;
        min-width: 100px;
    }

    .metronomeButton {
        width: 18px;
        height: 18px;
    }

    /* Piano Chassis fills ALL remaining space */
    .pianoChassis {
        padding: 0;
        margin: 0;
        border-radius: 0;
        flex: 1 1 auto;
        /* Grow and shrink */
        display: flex;
        align-items: stretch;
        overflow-y: hidden;
        overflow-x: auto;
        box-shadow: none;
        width: 100%;
        border: none;
        background: transparent;
        height: auto;
        /* Let flex handle it */
    }

    .pianoChassis::-webkit-scrollbar {
        height: 0;
        width: 0;
    }

    .keysContainer {
        height: 100%;
        display: flex;
        align-items: stretch;
    }

    .whiteKey {
        width: 60px;
        height: 100% !important;
        min-height: auto;
        border-radius: 0 0 6px 6px;
        border-bottom-width: 4px !important;
    }

    .blackKey {
        width: 38px;
        height: 60% !important;
        border-radius: 0 0 4px 4px;
    }

    .midiStatus {
        display: none;
    }
}

/* Mobile Responsive (General) */
@media (max-width: 768px) {
    .container {
        /* Reset height logic for general mobile if not caught by specific queries */
        height: 100vh;
        height: 100dvh;
        /* Dynamic usage */
        justify-content: flex-start;
        padding-top: 20px;
        overflow-y: auto;
        /* Allow layout scrolling if needed */
    }

    .header {
        margin-bottom: 1rem;
    }

    .title {
        font-size: 1.5rem;
    }

    .controlPanel {
        flex-wrap: wrap;
        width: 90%;
        padding: 1rem;
        border-radius: 20px;
        gap: 1rem;
        justify-content: center;
        margin-bottom: 1rem;
    }

    .controlGroup {
        flex: 1 1 40%;
        min-width: 120px;
    }

    .controlGroup+.controlGroup {
        border-left: none;
        padding-left: 0;
        border-top: 1px solid #eee;
        /* Optional visual separator for stacked items? Or just gap */
        padding-top: 0;
        /* Let flex gap handle it */
    }

    /* Specific adjustment to remove borders completely on mobile for cleaner look */
    .controlGroup+.controlGroup {
        border: none;
        padding: 0;
    }

    .pianoChassis {
        width: 95%;
        padding: 10px;
        overflow-x: auto;
        /* Horizontal scroll for keys */
        -webkit-overflow-scrolling: touch;
        justify-content: flex-start;
        /* Ensure start alignment */
    }

    .pianoChassis::-webkit-scrollbar {
        height: 6px;
    }

    .pianoChassis::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 3px;
    }

    .keysContainer {
        /* Ensure user can scroll to see all keys */
        min-width: max-content;
        padding-bottom: 10px;
        /* Space for scrollbar */
    }

    .whiteKey {
        width: 44px;
        /* Slightly narrower on mobile? or keep same */
        height: 220px;
        /* Shorter */
    }

    .blackKey {
        width: 28px;
        height: 130px;
        /* Need to recalculate left positions in JS or use percentages, but JS fixed px is used currently. 
           We might need to adjust the calculation logic in TSX if we change width here.
           Let's KEEP WIDTHS SAME for simplicity of 'left' calculation, just enable SCROLL.
        */
        width: 40px;
        height: 170px;
    }

    /* If we keep widths same, we just rely on scroll */
    .whiteKey {
        width: 60px;
        height: 280px;
    }

    .blackKey {
        width: 40px;
        height: 170px;
    }
}